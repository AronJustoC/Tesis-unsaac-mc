from src.structures import Structure
from src.analysis import modal_analysis
from src.visualization import plot_mode_shape
from src.visualization import plot_structure
import numpy as np


def main():
    structure = Structure()

    # ========== Definir propiedades de materiales ==========
    materials = {
        "ASTM-A36": {
            "E": 200e9,  # Módulo de elasticidad (Pa)
            "G": 77e9,  # Módulo de corte (Pa)
            "rho": 7850,  # Densidad (kg/m³)
        }
    }

    # ========== Definir propiedades de secciones ==========
    sections = {
        "80x40": {
            "area": 0.08 * 0.04,  # 3200 mm²
            "Ix": 2133333.34e-12,  # Torsion constant
            "Iy": 426666.67e-12,  # Moment of inertia about y-axis
            "Iz": 1706666.67e-12,  # Moment of inertia about z-axis
        },
        "100x80": {
            "area": 0.10 * 0.08,  # 8000 mm²
            "Ix": 10933333.34e-12,  # Torsion constant
            "Iy": 6666666.67e-12,  # Moment of inertia about y-axis
            "Iz": 4266666.67e-12,  # Moment of inertia about z-axis
        },
        "80x80": {
            "area": 0.08 * 0.08,  # 6400 mm²
            "Ix": 6826666.66e-12,  # Torsion constant
            "Iy": 3413333.33e-12,  # Moment of inertia about y-axis
            "Iz": 3413333.33e-12,  # Moment of inertia about z-axis
        },
        "H420x180": {  # H-section
            "area": 0.42 * 0.02 + 2 * 0.18 * 0.02,  # Web + 2 Flanges
            "Ix": 399386666.66e-12,  # Torsion constant
            "Iy": 379693333.33e-12,  # Major axis moment of inertia
            "Iz": 19693333.33e-12,  # Minor axis moment of inertia
        },
    }

    # ========== Agregar nodos ==========
    node_coords = {}
    for row in [
        # ID: (x, y, z) en metros (convertidos de mm)
        (1, 0, 0, 0),
        (2, 0, 0, 1100),
        (3, 0, 0, 2200),
        (4, 762.5, 0, 0),
        (5, 762.5, 0, 2200),
        (6, 1525, 0, 0),
        (7, 1525, 0, 1100),
        (8, 1525, 0, 2200),
        (9, 2287.5, 0, 0),
        (10, 2287.5, 0, 2200),
        (11, 3050, 0, 0),
        (12, 3050, 0, 1100),
        (13, 3050, 0, 2200),
        (14, 3812.5, 0, 0),
        (15, 3812.5, 0, 2200),
        (16, 4575, 0, 0),
        (17, 4575, 0, 1100),
        (18, 4575, 0, 2200),
        (19, 5337.5, 0, 0),
        (20, 5337.5, 0, 2200),
        (21, 6100, 0, 0),
        (22, 6100, 0, 1100),
        (23, 6100, 0, 2200),
        (24, 6862.5, 0, 0),
        (25, 6862.5, 0, 2200),
        (26, 7625, 0, 0),
        (27, 7625, 0, 1100),
        (28, 7625, 0, 2200),
        (29, 8387.5, 0, 0),
        (30, 8387.5, 0, 2200),
        (31, 9150, 0, 0),
        (32, 9150, 0, 1100),
        (33, 9150, 0, 2200),
        (34, 9912.5, 0, 0),
        (35, 9912.5, 0, 2200),
        (36, 10675, 0, 0),
        (37, 10675, 0, 1100),
        (38, 10675, 0, 2200),
        (39, 11437.5, 0, 0),
        (40, 11437.5, 0, 2200),
        (41, 12200, 0, 0),
        (42, 12200, 0, 1100),
        (43, 12200, 0, 2200),
        (44, 12962.5, 0, 0),
        (45, 12962.5, 0, 2200),
        (46, 13725, 0, 0),
        (47, 13725, 0, 1100),
        (48, 13725, 0, 2200),
        (49, 14487.5, 0, 0),
        (50, 14487.5, 0, 2200),
        (51, 15250, 0, 0),
        (52, 15250, 0, 1100),
        (53, 15250, 0, 2200),
        (54, 16012.5, 0, 0),
        (55, 16012.5, 0, 2200),
        (56, 16775, 0, 0),
        (57, 16775, 0, 1100),
        (58, 16775, 0, 2200),
        (59, 17537.5, 0, 0),
        (60, 17537.5, 0, 2200),
        (61, 18300, 0, 0),
        (62, 18300, 0, 1100),
        (63, 18300, 0, 2200),
        (64, 19062.5, 0, 0),
        (65, 19062.5, 0, 2200),
        (66, 19825, 0, 0),
        (67, 19825, 0, 1100),
        (68, 19825, 0, 2200),
        (69, 20587.5, 0, 0),
        (70, 20587.5, 0, 2200),
        (71, 21350, 0, 0),
        (72, 21350, 0, 1100),
        (73, 21350, 0, 2200),
        (74, 0, -700, 0),
        (75, 3050, -700, 0),
        (76, 6100, -700, 0),
        (77, 9150, -700, 0),
        (78, 12200, -700, 0),
        (79, 15250, -700, 0),
        (80, 18300, -700, 0),
        (81, 21350, -700, 0),
        (82, 0, 5000, 0),
        (83, 0, 5000, 1100),
        (84, 0, 5000, 2200),
        (85, 762.5, 5000, 0),
        (86, 762.5, 5000, 2200),
        (87, 1525, 5000, 0),
        (88, 1525, 5000, 1100),
        (89, 1525, 5000, 2200),
        (90, 2287.5, 5000, 0),
        (91, 2287.5, 5000, 2200),
        (92, 3050, 5000, 0),
        (93, 3050, 5000, 1100),
        (94, 3050, 5000, 2200),
        (95, 3812.5, 5000, 0),
        (96, 3812.5, 5000, 2200),
        (97, 4575, 5000, 0),
        (98, 4575, 5000, 1100),
        (99, 4575, 5000, 2200),
        (100, 5337.5, 5000, 0),
        (101, 5337.5, 5000, 2200),
        (102, 6100, 5000, 0),
        (103, 6100, 5000, 1100),
        (104, 6100, 5000, 2200),
        (105, 6862.5, 5000, 0),
        (106, 6862.5, 5000, 2200),
        (107, 7625, 5000, 0),
        (108, 7625, 5000, 1100),
        (109, 7625, 5000, 2200),
        (110, 8387.5, 5000, 0),
        (111, 8387.5, 5000, 2200),
        (112, 9150, 5000, 0),
        (113, 9150, 5000, 1100),
        (114, 9150, 5000, 2200),
        (115, 9912.5, 5000, 0),
        (116, 9912.5, 5000, 2200),
        (117, 10675, 5000, 0),
        (118, 10675, 5000, 1100),
        (119, 10675, 5000, 2200),
        (120, 11437.5, 5000, 0),
        (121, 11437.5, 5000, 2200),
        (122, 12200, 5000, 0),
        (123, 12200, 5000, 1100),
        (124, 12200, 5000, 2200),
        (125, 12962.5, 5000, 0),
        (126, 12962.5, 5000, 2200),
        (127, 13725, 5000, 0),
        (128, 13725, 5000, 1100),
        (129, 13725, 5000, 2200),
        (130, 14487.5, 5000, 0),
        (131, 14487.5, 5000, 2200),
        (132, 15250, 5000, 0),
        (133, 15250, 5000, 1100),
        (134, 15250, 5000, 2200),
        (135, 16012.5, 5000, 0),
        (136, 16012.5, 5000, 2200),
        (137, 16775, 5000, 0),
        (138, 16775, 5000, 1100),
        (139, 16775, 5000, 2200),
        (140, 17537.5, 5000, 0),
        (141, 17537.5, 5000, 2200),
        (142, 18300, 5000, 0),
        (143, 18300, 5000, 1100),
        (144, 18300, 5000, 2200),
        (145, 19062.5, 5000, 0),
        (146, 19062.5, 5000, 2200),
        (147, 19825, 5000, 0),
        (148, 19825, 5000, 1100),
        (149, 19825, 5000, 2200),
        (150, 20587.5, 5000, 0),
        (151, 20587.5, 5000, 2200),
        (152, 21350, 5000, 0),
        (153, 21350, 5000, 1100),
        (154, 21350, 5000, 2200),
        (155, 0, 5700, 0),
        (156, 3050, 5700, 0),
        (157, 6100, 5700, 0),
        (158, 9150, 5700, 0),
        (159, 12200, 5700, 0),
        (160, 15250, 5700, 0),
        (161, 18300, 5700, 0),
        (162, 21350, 5700, 0),
    ]:
        node_id = row[0]
        coords = (row[1] / 1000, row[2] / 1000, row[3] / 1000)  # Conversión mm -> m
        node_coords[node_id] = structure.add_node(*coords)

    # ========== Agregar elementos ==========
    elements = [
        # (nodo_inicial, nodo_final, sección, material)
        (1, 2, "80x40", "ASTM-A36"),
        (2, 3, "80x40", "ASTM-A36"),
        (1, 4, "100x80", "ASTM-A36"),
        (2, 4, "80x40", "ASTM-A36"),
        (2, 5, "80x40", "ASTM-A36"),
        (3, 5, "100x80", "ASTM-A36"),
        (4, 6, "100x80", "ASTM-A36"),
        (4, 7, "80x40", "ASTM-A36"),
        (5, 7, "80x40", "ASTM-A36"),
        (5, 8, "100x80", "ASTM-A36"),
        (6, 7, "80x40", "ASTM-A36"),
        (7, 8, "80x40", "ASTM-A36"),
        (6, 9, "100x80", "ASTM-A36"),
        (7, 9, "80x40", "ASTM-A36"),
        (7, 10, "80x40", "ASTM-A36"),
        (8, 10, "100x80", "ASTM-A36"),
        (9, 11, "100x80", "ASTM-A36"),
        (9, 12, "80x40", "ASTM-A36"),
        (10, 12, "80x40", "ASTM-A36"),
        (10, 13, "100x80", "ASTM-A36"),
        (11, 12, "80x80", "ASTM-A36"),
        (12, 13, "80x80", "ASTM-A36"),
        (11, 14, "100x80", "ASTM-A36"),
        (12, 14, "80x40", "ASTM-A36"),
        (12, 15, "80x40", "ASTM-A36"),
        (13, 15, "100x80", "ASTM-A36"),
        (14, 16, "100x80", "ASTM-A36"),
        (14, 17, "80x40", "ASTM-A36"),
        (15, 17, "80x40", "ASTM-A36"),
        (15, 18, "100x80", "ASTM-A36"),
        (16, 17, "80x40", "ASTM-A36"),
        (17, 18, "80x40", "ASTM-A36"),
        (16, 19, "100x80", "ASTM-A36"),
        (17, 19, "80x40", "ASTM-A36"),
        (17, 20, "80x40", "ASTM-A36"),
        (18, 20, "100x80", "ASTM-A36"),
        (19, 21, "100x80", "ASTM-A36"),
        (19, 22, "80x40", "ASTM-A36"),
        (20, 22, "80x40", "ASTM-A36"),
        (20, 23, "100x80", "ASTM-A36"),
        (21, 22, "80x80", "ASTM-A36"),
        (22, 23, "80x80", "ASTM-A36"),
        (21, 24, "100x80", "ASTM-A36"),
        (22, 24, "80x40", "ASTM-A36"),
        (22, 25, "80x40", "ASTM-A36"),
        (23, 25, "100x80", "ASTM-A36"),
        (24, 26, "100x80", "ASTM-A36"),
        (24, 27, "80x40", "ASTM-A36"),
        (25, 27, "80x40", "ASTM-A36"),
        (25, 28, "100x80", "ASTM-A36"),
        (26, 27, "80x40", "ASTM-A36"),
        (27, 28, "80x40", "ASTM-A36"),
        (26, 29, "100x80", "ASTM-A36"),
        (27, 29, "80x40", "ASTM-A36"),
        (27, 30, "80x40", "ASTM-A36"),
        (28, 30, "100x80", "ASTM-A36"),
        (29, 31, "100x80", "ASTM-A36"),
        (29, 32, "80x40", "ASTM-A36"),
        (30, 32, "80x40", "ASTM-A36"),
        (30, 33, "100x80", "ASTM-A36"),
        (31, 32, "80x80", "ASTM-A36"),
        (32, 33, "80x80", "ASTM-A36"),
        (31, 34, "100x80", "ASTM-A36"),
        (32, 34, "80x40", "ASTM-A36"),
        (32, 35, "80x40", "ASTM-A36"),
        (33, 35, "100x80", "ASTM-A36"),
        (34, 36, "100x80", "ASTM-A36"),
        (34, 37, "80x40", "ASTM-A36"),
        (35, 37, "80x40", "ASTM-A36"),
        (35, 38, "100x80", "ASTM-A36"),
        (36, 37, "80x40", "ASTM-A36"),
        (37, 38, "80x40", "ASTM-A36"),
        (36, 39, "100x80", "ASTM-A36"),
        (37, 39, "80x40", "ASTM-A36"),
        (37, 40, "80x40", "ASTM-A36"),
        (38, 40, "100x80", "ASTM-A36"),
        (39, 41, "100x80", "ASTM-A36"),
        (39, 42, "80x40", "ASTM-A36"),
        (40, 42, "80x40", "ASTM-A36"),
        (40, 43, "100x80", "ASTM-A36"),
        (41, 42, "80x80", "ASTM-A36"),
        (42, 43, "80x80", "ASTM-A36"),
        (41, 44, "100x80", "ASTM-A36"),
        (42, 44, "80x40", "ASTM-A36"),
        (42, 45, "80x40", "ASTM-A36"),
        (43, 45, "100x80", "ASTM-A36"),
        (44, 46, "100x80", "ASTM-A36"),
        (44, 47, "80x40", "ASTM-A36"),
        (45, 47, "80x40", "ASTM-A36"),
        (45, 48, "100x80", "ASTM-A36"),
        (46, 47, "80x40", "ASTM-A36"),
        (47, 48, "80x40", "ASTM-A36"),
        (46, 49, "100x80", "ASTM-A36"),
        (47, 49, "80x40", "ASTM-A36"),
        (47, 50, "80x40", "ASTM-A36"),
        (48, 50, "100x80", "ASTM-A36"),
        (49, 51, "100x80", "ASTM-A36"),
        (49, 52, "80x40", "ASTM-A36"),
        (50, 52, "80x40", "ASTM-A36"),
        (50, 53, "100x80", "ASTM-A36"),
        (51, 52, "80x80", "ASTM-A36"),
        (52, 53, "80x80", "ASTM-A36"),
        (51, 54, "100x80", "ASTM-A36"),
        (52, 54, "80x40", "ASTM-A36"),
        (52, 55, "80x40", "ASTM-A36"),
        (53, 55, "100x80", "ASTM-A36"),
        (54, 56, "100x80", "ASTM-A36"),
        (54, 57, "80x40", "ASTM-A36"),
        (55, 57, "80x40", "ASTM-A36"),
        (55, 58, "100x80", "ASTM-A36"),
        (56, 57, "80x40", "ASTM-A36"),
        (57, 58, "80x40", "ASTM-A36"),
        (56, 59, "100x80", "ASTM-A36"),
        (57, 59, "80x40", "ASTM-A36"),
        (57, 60, "80x40", "ASTM-A36"),
        (58, 60, "100x80", "ASTM-A36"),
        (59, 61, "100x80", "ASTM-A36"),
        (59, 62, "80x40", "ASTM-A36"),
        (60, 62, "80x40", "ASTM-A36"),
        (60, 63, "100x80", "ASTM-A36"),
        (61, 62, "80x80", "ASTM-A36"),
        (62, 63, "80x80", "ASTM-A36"),
        (61, 64, "100x80", "ASTM-A36"),
        (62, 64, "80x40", "ASTM-A36"),
        (62, 65, "80x40", "ASTM-A36"),
        (63, 65, "100x80", "ASTM-A36"),
        (64, 66, "100x80", "ASTM-A36"),
        (64, 67, "80x40", "ASTM-A36"),
        (65, 67, "80x40", "ASTM-A36"),
        (65, 68, "100x80", "ASTM-A36"),
        (66, 67, "80x40", "ASTM-A36"),
        (67, 68, "80x40", "ASTM-A36"),
        (66, 69, "100x80", "ASTM-A36"),
        (67, 69, "80x40", "ASTM-A36"),
        (67, 70, "80x40", "ASTM-A36"),
        (68, 70, "100x80", "ASTM-A36"),
        (69, 71, "100x80", "ASTM-A36"),
        (69, 72, "80x40", "ASTM-A36"),
        (70, 72, "80x40", "ASTM-A36"),
        (70, 73, "100x80", "ASTM-A36"),
        (71, 72, "80x40", "ASTM-A36"),
        (72, 73, "80x40", "ASTM-A36"),
        (1, 74, "H420x180", "ASTM-A36"),
        (74, 3, "80x40", "ASTM-A36"),
        (11, 75, "H420x180", "ASTM-A36"),
        (75, 13, "80x40", "ASTM-A36"),
        (21, 76, "H420x180", "ASTM-A36"),
        (76, 23, "80x40", "ASTM-A36"),
        (31, 77, "H420x180", "ASTM-A36"),
        (77, 33, "80x40", "ASTM-A36"),
        (41, 78, "H420x180", "ASTM-A36"),
        (78, 43, "80x40", "ASTM-A36"),
        (51, 79, "H420x180", "ASTM-A36"),
        (79, 53, "80x40", "ASTM-A36"),
        (61, 80, "H420x180", "ASTM-A36"),
        (80, 63, "80x40", "ASTM-A36"),
        (71, 81, "H420x180", "ASTM-A36"),
        (81, 73, "80x40", "ASTM-A36"),
        (82, 83, "80x40", "ASTM-A36"),
        (83, 84, "80x40", "ASTM-A36"),
        (82, 85, "100x80", "ASTM-A36"),
        (83, 85, "80x40", "ASTM-A36"),
        (83, 86, "80x40", "ASTM-A36"),
        (84, 86, "100x80", "ASTM-A36"),
        (85, 87, "100x80", "ASTM-A36"),
        (85, 88, "80x40", "ASTM-A36"),
        (86, 88, "80x40", "ASTM-A36"),
        (86, 89, "100x80", "ASTM-A36"),
        (87, 88, "80x40", "ASTM-A36"),
        (88, 89, "80x40", "ASTM-A36"),
        (87, 90, "100x80", "ASTM-A36"),
        (88, 90, "80x40", "ASTM-A36"),
        (88, 91, "80x40", "ASTM-A36"),
        (89, 91, "100x80", "ASTM-A36"),
        (90, 92, "100x80", "ASTM-A36"),
        (90, 93, "80x40", "ASTM-A36"),
        (91, 93, "80x40", "ASTM-A36"),
        (91, 94, "100x80", "ASTM-A36"),
        (92, 93, "80x80", "ASTM-A36"),
        (93, 94, "80x80", "ASTM-A36"),
        (92, 95, "100x80", "ASTM-A36"),
        (93, 95, "80x40", "ASTM-A36"),
        (93, 96, "80x40", "ASTM-A36"),
        (94, 96, "100x80", "ASTM-A36"),
        (95, 97, "100x80", "ASTM-A36"),
        (95, 98, "80x40", "ASTM-A36"),
        (96, 98, "80x40", "ASTM-A36"),
        (96, 99, "100x80", "ASTM-A36"),
        (97, 98, "80x40", "ASTM-A36"),
        (98, 99, "80x40", "ASTM-A36"),
        (97, 100, "100x80", "ASTM-A36"),
        (98, 100, "80x40", "ASTM-A36"),
        (98, 101, "80x40", "ASTM-A36"),
        (99, 101, "100x80", "ASTM-A36"),
        (100, 102, "100x80", "ASTM-A36"),
        (100, 103, "80x40", "ASTM-A36"),
        (101, 103, "80x40", "ASTM-A36"),
        (101, 104, "100x80", "ASTM-A36"),
        (102, 103, "80x80", "ASTM-A36"),
        (103, 104, "80x80", "ASTM-A36"),
        (102, 105, "100x80", "ASTM-A36"),
        (103, 105, "80x40", "ASTM-A36"),
        (103, 106, "80x40", "ASTM-A36"),
        (104, 106, "100x80", "ASTM-A36"),
        (105, 107, "100x80", "ASTM-A36"),
        (105, 108, "80x40", "ASTM-A36"),
        (106, 108, "80x40", "ASTM-A36"),
        (106, 109, "100x80", "ASTM-A36"),
        (107, 108, "80x40", "ASTM-A36"),
        (108, 109, "80x40", "ASTM-A36"),
        (107, 110, "100x80", "ASTM-A36"),
        (108, 110, "80x40", "ASTM-A36"),
        (108, 111, "80x40", "ASTM-A36"),
        (109, 111, "100x80", "ASTM-A36"),
        (110, 112, "100x80", "ASTM-A36"),
        (110, 113, "80x40", "ASTM-A36"),
        (111, 113, "80x40", "ASTM-A36"),
        (111, 114, "100x80", "ASTM-A36"),
        (112, 113, "80x80", "ASTM-A36"),
        (113, 114, "80x80", "ASTM-A36"),
        (112, 115, "100x80", "ASTM-A36"),
        (113, 115, "80x40", "ASTM-A36"),
        (113, 116, "80x40", "ASTM-A36"),
        (114, 116, "100x80", "ASTM-A36"),
        (115, 117, "100x80", "ASTM-A36"),
        (115, 118, "80x40", "ASTM-A36"),
        (116, 118, "80x40", "ASTM-A36"),
        (116, 119, "100x80", "ASTM-A36"),
        (117, 118, "80x40", "ASTM-A36"),
        (118, 119, "80x40", "ASTM-A36"),
        (117, 120, "100x80", "ASTM-A36"),
        (118, 120, "80x40", "ASTM-A36"),
        (118, 121, "80x40", "ASTM-A36"),
        (119, 121, "100x80", "ASTM-A36"),
        (120, 122, "100x80", "ASTM-A36"),
        (120, 123, "80x40", "ASTM-A36"),
        (121, 123, "80x40", "ASTM-A36"),
        (121, 124, "100x80", "ASTM-A36"),
        (122, 123, "80x80", "ASTM-A36"),
        (123, 124, "80x80", "ASTM-A36"),
        (122, 125, "100x80", "ASTM-A36"),
        (123, 125, "80x40", "ASTM-A36"),
        (123, 126, "80x40", "ASTM-A36"),
        (124, 126, "100x80", "ASTM-A36"),
        (125, 127, "100x80", "ASTM-A36"),
        (125, 128, "80x40", "ASTM-A36"),
        (126, 128, "80x40", "ASTM-A36"),
        (126, 129, "100x80", "ASTM-A36"),
        (127, 128, "80x40", "ASTM-A36"),
        (128, 129, "80x40", "ASTM-A36"),
        (127, 130, "100x80", "ASTM-A36"),
        (128, 130, "80x40", "ASTM-A36"),
        (128, 131, "80x40", "ASTM-A36"),
        (129, 131, "100x80", "ASTM-A36"),
        (130, 132, "100x80", "ASTM-A36"),
        (130, 133, "80x40", "ASTM-A36"),
        (131, 133, "80x40", "ASTM-A36"),
        (131, 134, "100x80", "ASTM-A36"),
        (132, 133, "80x80", "ASTM-A36"),
        (133, 134, "80x80", "ASTM-A36"),
        (132, 135, "100x80", "ASTM-A36"),
        (133, 135, "80x40", "ASTM-A36"),
        (133, 136, "80x40", "ASTM-A36"),
        (134, 136, "100x80", "ASTM-A36"),
        (135, 137, "100x80", "ASTM-A36"),
        (135, 138, "80x40", "ASTM-A36"),
        (136, 138, "80x40", "ASTM-A36"),
        (136, 139, "100x80", "ASTM-A36"),
        (137, 138, "80x40", "ASTM-A36"),
        (138, 139, "80x40", "ASTM-A36"),
        (137, 140, "100x80", "ASTM-A36"),
        (138, 140, "80x40", "ASTM-A36"),
        (138, 141, "80x40", "ASTM-A36"),
        (139, 141, "100x80", "ASTM-A36"),
        (140, 142, "100x80", "ASTM-A36"),
        (140, 143, "80x40", "ASTM-A36"),
        (141, 143, "80x40", "ASTM-A36"),
        (141, 144, "100x80", "ASTM-A36"),
        (142, 143, "80x80", "ASTM-A36"),
        (143, 144, "80x80", "ASTM-A36"),
        (142, 145, "100x80", "ASTM-A36"),
        (143, 145, "80x40", "ASTM-A36"),
        (143, 146, "80x40", "ASTM-A36"),
        (144, 146, "100x80", "ASTM-A36"),
        (145, 147, "100x80", "ASTM-A36"),
        (145, 148, "80x40", "ASTM-A36"),
        (146, 148, "80x40", "ASTM-A36"),
        (146, 149, "100x80", "ASTM-A36"),
        (147, 148, "80x40", "ASTM-A36"),
        (148, 149, "80x40", "ASTM-A36"),
        (147, 150, "100x80", "ASTM-A36"),
        (148, 150, "80x40", "ASTM-A36"),
        (148, 151, "80x40", "ASTM-A36"),
        (149, 151, "100x80", "ASTM-A36"),
        (150, 152, "100x80", "ASTM-A36"),
        (150, 153, "80x40", "ASTM-A36"),
        (151, 153, "80x40", "ASTM-A36"),
        (151, 154, "100x80", "ASTM-A36"),
        (152, 153, "80x40", "ASTM-A36"),
        (153, 154, "80x40", "ASTM-A36"),
        (82, 155, "H420x180", "ASTM-A36"),
        (155, 84, "80x40", "ASTM-A36"),
        (92, 156, "H420x180", "ASTM-A36"),
        (156, 94, "80x40", "ASTM-A36"),
        (102, 157, "H420x180", "ASTM-A36"),
        (157, 104, "80x40", "ASTM-A36"),
        (112, 158, "H420x180", "ASTM-A36"),
        (158, 114, "80x40", "ASTM-A36"),
        (122, 159, "H420x180", "ASTM-A36"),
        (159, 124, "80x40", "ASTM-A36"),
        (132, 160, "H420x180", "ASTM-A36"),
        (160, 134, "80x40", "ASTM-A36"),
        (142, 161, "H420x180", "ASTM-A36"),
        (161, 144, "80x40", "ASTM-A36"),
        (152, 162, "H420x180", "ASTM-A36"),
        (162, 154, "80x40", "ASTM-A36"),
        (1, 82, "H420x180", "ASTM-A36"),
        (1, 92, "80x40", "ASTM-A36"),
        (11, 82, "80x40", "ASTM-A36"),
        (11, 92, "H420x180", "ASTM-A36"),
        (11, 102, "80x40", "ASTM-A36"),
        (21, 92, "80x40", "ASTM-A36"),
        (21, 102, "H420x180", "ASTM-A36"),
        (21, 112, "80x40", "ASTM-A36"),
        (31, 102, "80x40", "ASTM-A36"),
        (31, 112, "H420x180", "ASTM-A36"),
        (31, 122, "80x40", "ASTM-A36"),
        (41, 112, "80x40", "ASTM-A36"),
        (41, 122, "H420x180", "ASTM-A36"),
        (41, 132, "80x40", "ASTM-A36"),
        (51, 122, "80x40", "ASTM-A36"),
        (51, 132, "H420x180", "ASTM-A36"),
        (51, 142, "80x40", "ASTM-A36"),
        (61, 132, "80x40", "ASTM-A36"),
        (61, 142, "H420x180", "ASTM-A36"),
        (61, 152, "80x40", "ASTM-A36"),
        (71, 142, "80x40", "ASTM-A36"),
        (71, 152, "H420x180", "ASTM-A36"),
    ]

    for el in elements:
        structure.add_element(
            node_coords[el[0]], node_coords[el[1]], sections[el[2]], materials[el[3]]
        )

    # ========== Aplicar restricciones ==========
    constraints = {
        1: ["ux", "uy", "uz"],
        82: [
            "ux",
            "uy",
            "uz",
        ],
        71: ["uy", "uz"],
        152: ["uy", "uz"],
    }

    for node_id, dofs in constraints.items():
        structure.add_constraint(node_coords[node_id], dofs)
    # Graficar estructura
    plot_structure(structure)

    # ========== Análisis Modal con parámetros robustos ==========
    try:
        constrained_dofs = structure.get_constrained_dofs()
        # Usar shift-invert para evitar matrices singulares
        freqs, modes = modal_analysis(
            structure,
            num_modes=10,
            constrained_dofs=constrained_dofs,
        )
        print("\nNatural Frequencies:")
        print("-" * 30)
        for i, freq in enumerate(freqs, 1):
            print(f"Mode {i}: {freq:.2f} Hz")

        # Visualizar los modos
        for i in range(len(freqs)):
            plot_mode_shape(
                structure,
                modes[:, i],
                title=f"Modo {i + 1} - {freqs[i]:.2f} Hz",
                deformation_scale=50,
            )

    except Exception as e:
        print(f"Error en el análisis: {str(e)}")


if __name__ == "__main__":
    main()
